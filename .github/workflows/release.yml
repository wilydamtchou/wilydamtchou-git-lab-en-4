name: Promote Release

on:
  workflow_dispatch:

permissions:
  contents: write  # ✅ Allow writing to repository

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          clean: true

      - uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17
          cache: maven  # ✅ Cache Maven dependencies

      - name: Configure Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: Create and Push Release Tag
        run: |
          VERSION=$(date +%Y.%m.%d)
          TIMESTAMP=$(date +%H%M%S)
          TAG=v${VERSION}-${TIMESTAMP}
          
          # Create tag on current commit
          git tag $TAG
          
          # Push tag to remote
          git push https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git $TAG
          
          echo "✅ Release tag $TAG created and pushed successfully!"
